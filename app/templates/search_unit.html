{% extends "base_main.html" %}

{% block title %}Unit Search{% endblock %}
{% block banner_title %}Unit Search{% endblock %}
{% block banner_subtitle %}
<div class="text-center">
Please enter unit details or upload a file here.
</div>
{% endblock %}

{% block content %}
<!--
  Template: Unit Search
  Purpose:
    - Let users search units by name or code.
    - Show results with quick link to the unit detail page (/view/<id>).
-->
<div class="container my-5">

    <!-- Search form container -->
    <div class="container my-5 text-center d-flex justify-content-center gap-3">
        
        
        <!-- Normal Search Form (GET) -->
        <form method="get" action="{{ url_for('main.search_unit') }}" class="d-inline" style="max-width: 600px; width: 100%;">
            
            <!-- Query + filter selector -->
            <div class="input-group input-group-lg mb-4 mx-auto rounded-pill border border-dark overflow-hidden">
                <!-- Search query -->
                <input type="text" name="query" class="form-control border-0" placeholder="Search" value="{{ query }}">
                
                <!-- Filter type -->
                <select name="filter" class="form-select form-select-sm border-0 bg-light text-dark rounded-pill px-2"
                style="width: 150px; flex: 0 0 auto; font-size: 0.95rem;">
                <option value="name" {% if filter_type=='name' %}selected{% endif %}>By Unit Name</option>
                <option value="code" {% if filter_type=='code' %}selected{% endif %}>By Unit Code</option>
            </select>
        </div>
        
        <!-- Submit -->
        <div class="d-flex justify-content-center gap-3">
            <button type="submit" class="btn btn-warning text-dark px-4" style="width:180px;">View Results</button>
        </div>
    </form>
    
    
</div>


<!-- Results Section -->
{% if results %}
<div class="container pt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Heading reflects whether a query was provided -->
        <h4 class="fw-bold mb-0">
            {% if query %}
            RESULTS
            {% else %}
            Showing all units
            {% endif %}
        </h4>

        <!-- Sort control: reloads page with ?sort=... -->
        <select class="form-select w-auto" onchange="location.href=this.value;">
            <option value="?query={{ query }}&filter={{ filter_type }}&sort=unitcode" {% if sort_by=='unitcode' %}selected{% endif %}>Sort by Unit Code</option>
            <option value="?query={{ query }}&filter={{ filter_type }}&sort=unitlevel" {% if sort_by=='unitlevel' %}selected{% endif %}>Sort by Unit Level</option>
        </select>
    </div>

    <!-- Results list: each item links to the unit detail page -->
    <ul class="list-unstyled" style="max-height:300px; overflow-y:auto;">
        {% for unit in results %}
        <li class="mb-3 p-3 border rounded bg-light">
            <!-- Unit detail link (/view/<id>) -->
            <a href="{{ url_for('main.view', unit_id=unit.id) }}"
            class="fw-bold text-dark text-decoration-none link-hover">
            {{ unit.unitname }} [{{ unit.unitcode }}]
        </a>
        <br>
        Credit points: {{ unit.creditpoints }} | Level: {{ unit.level }}<br>
        Description: {{ unit.description or "No description available" }}
    </li>
    {% endfor %}
</ul>
</div>

{% elif query %}
<!-- No-results message shown only if a query was submitted -->
<p class="text-center text-muted">No results found for "{{ query }}"</p>
{% endif %}

<!-- JS for hover effect: underline + color on hover for result links -->
<script>
    document.querySelectorAll('.link-hover').forEach(link => {
        link.addEventListener('mouseenter', () => {
            link.style.color = 'blue';
            link.style.textDecoration = 'underline';
        });
        link.addEventListener('mouseleave', () => {
            link.style.color = 'black';
            link.style.textDecoration = 'none';
        });
    });
    </script>
</div>
{% endblock %}


