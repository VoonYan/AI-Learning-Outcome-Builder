{% extends "base_main.html" %}

{% block title %}Admin Configuration{% endblock %}
{% block banner_title %}Admin Settings{% endblock %}
{% block banner_subtitle %}
<div class="text-center">
Configure AI models, taxonomy settings, and learning outcome parameters
</div>
{% endblock %}

{% block content %}
<!-- Main content wrapper for admin configuration -->
  <main class="flex-grow-1">
    <div class="container my-4">

      {# Flash messages (success) ------------------------------------------------ #}
      {% with messages = get_flashed_messages(category_filter=["success"])%}
      {% if messages%}
      {% for message in messages%}
      <div id="successMessage" class="alert alert-success" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>{{message}}
      </div>      
      {%endfor%}
      {%endif%}
      {%endwith%}


      {# Flash messages (error) -------------------------------------------------- #}
      {% with messages = get_flashed_messages(category_filter=["error"])%}
      {% if messages%}
      {% for message in messages%}
      <div id="successMessage" class="alert alert-danger" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>{{message}}
      </div>      
      {%endfor%}
      {%endif%}
      {%endwith%}

      <!-- Admin settings form -->
      <form id="adminSettingsForm" action="{{ url_for('main.admin') }}" method="POST">
      {{ form.hidden_tag() }}

        <!-- AI Configuration: model selection + API key -->
        <section class="card border-warning border-2 shadow-sm mb-4">
          <div class="card-body">
            <h3 class="h5 text-black border-bottom border-warning pb-2 mb-4 d-flex align-items-center">
              <i class="bi bi-cpu me-2"></i>AI Configuration
            </h3>

            <div class="row g-3">
              <!-- Model select -->
              <div class="col-md-6">
                {{form.model.label(class="form-label")}}
                {{form.model(class="form-select")}}
                <div class="form-text">Select the AI model for generating learning outcomes</div>
                <!-- Initializes selected model value -->
                <script>
                    document.getElementById('modelSelect').value = "{{config['selected_model']}}";
                </script>
              </div>

              <!-- API key input -->
              <div class="col-md-6">
                {{form.apikey.label(class="form-label")}}
                {{form.apikey(class="form-control", placeholder="Enter API key...", value=config['API_key'] )}}
                <div class="form-text">Your secure API key for AI services. Use 'environ' to use server enviroment variable.</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Bloom's Taxonomy Word Lists: 6 categories -->
        <section class="card border-warning border-2 shadow-sm mb-4">
          <div class="card-body">
            <h3 class="h5 text-black border-bottom border-warning pb-2 mb-4 d-flex align-items-center">
              <i class="bi bi-list-ul me-2"></i>Bloom's Taxonomy Word Lists
            </h3>

            <div class="row">
              {% set bloom_fields = [
                  ('knowledge', config['Knowledge']),
                  ('comprehension', config['Comprehension']),
                  ('application', config['Application']),
                  ('analysis', config['Analysis']),
                  ('synthesis', config['Synthesis']),
                  ('evaluation', config['Evaluation'])
              ] %}

              {% for field_name, placeholder in bloom_fields %}
                <div class="col-md-6 mb-3">
                  <div class="card bg-light border">
                    <div class="card-body">
                      <i class="bi bi-{{ loop.index }}-circle-fill text-warning me-1"></i>
                      {{ getattr(form, field_name).label(class="form-label") }}
                      {{ getattr(form, field_name)(class="form-control", placeholder=placeholder, rows="4") }}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </section>


        <!-- Banned Words in LOs -->
        <section class="card border-warning border-2 shadow-sm mb-4">
          <div class="card-body">
            <h3 class="h5 text-black border-bottom border-warning pb-2 mb-4 d-flex align-items-center">
              <i class="bi bi-exclamation-triangle me-2"></i>Banned Words in Learning Outcomes
            </h3>

            <div class="mb-3">
              {{form.banned.label(class="form-label")}}
              {{form.banned(class="form-control", placeholder="Enter banned words separated by commas...", rows="4")}}
              <div class="form-text">These words will be flagged or removed from generated learning outcomes</div>
            </div>
          </div>
        </section>

        <!-- Unit Level to Taxonomy Mapping -->
        <section class="card border-warning border-2 shadow-sm mb-4">
          <div class="card-body">
            <h3 class="h5 text-black border-bottom border-warning pb-2 mb-4 d-flex align-items-center">
              <i class="bi bi-diagram-3 me-2"></i>Unit Level to Taxonomy Mapping
            </h3>

                <div class="row g-3">
                {% for i in range(1,7) %}
                    <div class="col-md-6">
                    {{ getattr(form, 'level' ~ i).label(class="form-label") }}
                    {{ getattr(form, 'level' ~ i)(class="form-control", 
                        placeholder=config['Level ' ~ i], 
                        value=config['Level ' ~ i]) }}
                    </div>
                {% endfor %}
                </div>
            </div>
        </section>

        <!-- Learning Outcomes per Credit Points -->
        <section class="card border-warning border-2 shadow-sm mb-4">
          <div class="card-body">
            <h3 class="h5 text-black border-bottom border-warning pb-2 mb-4 d-flex align-items-center">
              <i class="bi bi-mortarboard me-2"></i>Learning Outcomes per Credit Points
            </h3>

            <div class="row g-3">
              <!-- 6 CP -->
              <div class="col-md-4">
                {{form.cp6.label(class="form-label")}}
                {{form.cp6(class="form-control", placeholder="3-6", value=config['6 Points'])}}
                {% for error in form.cp6.errors %}
                        <div class="alert alert-danger" role="alert">{{error}}</div>
                {%endfor%}
                <div class="form-text">Range of learning outcomes. Must use format of [num]-[num] e.g. 3-6</div>
              </div>

              <!-- 12 CP -->
              <div class="col-md-4">
                {{form.cp12.label(class="form-label")}}
                {{form.cp12(class="form-control", placeholder="5-9", value=config['12 Points'])}}
                {% for error in form.cp12.errors %}
                        <div class="alert alert-danger" role="alert">{{error}}</div>
                {%endfor%}
                <div class="form-text">Range of learning outcomes. Must use format of [num]-[num] e.g. 5-9</div>
              </div>

              <!-- 24 CP -->
              <div class="col-md-4">
                {{form.cp24.label(class="form-label")}}
                {{form.cp24(class="form-control", placeholder="8-12", value=config['24 Points'])}}
                {% for error in form.cp24.errors %}
                        <div class="alert alert-danger" role="alert">{{error}}</div>
                {%endfor%}
                <div class="form-text">Range of learning outcomes. Must use format of [num]-[num] e.g. 8-12</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Actions: reset/undo/save -->
        <div class="d-flex flex-wrap justify-content-center gap-2 mt-4">
          <button type="button" class="btn btn-danger px-4" onclick="resetDefault()">
            <i class="bi bi-x-circle me-2"></i>Reset to Default
          </button>
          <button type="button" class="btn btn-secondary px-4" onclick="undoChanges()">
            <i class="bbi bi-arrow-counterclockwise me-2"></i>Undo Changes
          </button>
          <button type="submit" class="btn btn-warning px-4">
            <i class="bi bi-check-circle me-2"></i>Save Changes
          </button>
        </div>

      </form>
    </div>
  </main>

<!-- Page script: admin tools (handles reset/undo behaviors) -->
<script src="{{ url_for('static', filename='js/admin_tools.js') }}"></script>
{% endblock %}
